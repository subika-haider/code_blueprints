<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Data Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .chart-content {
            height: 300px;
            position: relative;
        }

        .large-chart {
            grid-column: 1 / -1;
        }

        .large-chart .chart-content {
            height: 400px;
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
        }

        button:hover {
            background: #764ba2;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• Hospital Data Dashboard</h1>
        
        <div class="success-message">
            ‚úÖ All visualizations loaded successfully! Scroll down to see all 12 charts.
        </div>
        
        <!-- Statistics -->
        <div class="stats">
            <div class="stat-card">
                <span class="stat-number">2,500</span>
                <span class="stat-label">Total Patients</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">3,200</span>
                <span class="stat-label">Admissions</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">5.2</span>
                <span class="stat-label">Avg Length of Stay</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">4.8%</span>
                <span class="stat-label">Mortality Rate</span>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button onclick="refreshCharts()">üîÑ Refresh Data</button>
            <button onclick="exportData()">üìä Export Data</button>
            <button onclick="showInfo()">‚ÑπÔ∏è Chart Info</button>
        </div>

        <!-- Charts -->
        <div class="charts">
            <!-- Patient Demographics -->
            <div class="chart-container">
                <div class="chart-title">üë• Patient Demographics</div>
                <div class="chart-content">
                    <canvas id="demographicsChart"></canvas>
                </div>
            </div>

            <!-- Age Distribution -->
            <div class="chart-container">
                <div class="chart-title">üìä Age Distribution</div>
                <div class="chart-content">
                    <canvas id="ageChart"></canvas>
                </div>
            </div>

            <!-- Admission Types -->
            <div class="chart-container">
                <div class="chart-title">üö™ Admission Types</div>
                <div class="chart-content">
                    <canvas id="admissionChart"></canvas>
                </div>
            </div>

            <!-- Length of Stay -->
            <div class="chart-container">
                <div class="chart-title">‚è±Ô∏è Length of Stay by Department</div>
                <div class="chart-content">
                    <canvas id="losChart"></canvas>
                </div>
            </div>

            <!-- ICU Occupancy -->
            <div class="chart-container">
                <div class="chart-title">üè• ICU Occupancy by Unit</div>
                <div class="chart-content" id="icuChart"></div>
            </div>

            <!-- Discharge Destinations -->
            <div class="chart-container">
                <div class="chart-title">üè† Discharge Destinations</div>
                <div class="chart-content">
                    <canvas id="dischargeChart"></canvas>
                </div>
            </div>

            <!-- Vital Signs Trends -->
            <div class="chart-container large-chart">
                <div class="chart-title">üìà Vital Signs Trends</div>
                <div class="chart-content" id="vitalChart"></div>
            </div>

            <!-- Lab Test Heatmap -->
            <div class="chart-container large-chart">
                <div class="chart-title">üß™ Lab Test Activity Heatmap</div>
                <div class="chart-content" id="labHeatmap"></div>
            </div>

            <!-- Seasonal Patterns -->
            <div class="chart-container">
                <div class="chart-title">üìÖ Seasonal Admission Patterns</div>
                <div class="chart-content" id="seasonalChart"></div>
            </div>

            <!-- Mortality Rates -->
            <div class="chart-container">
                <div class="chart-title">üíî Mortality Rates by Department</div>
                <div class="chart-content">
                    <canvas id="mortalityChart"></canvas>
                </div>
            </div>

            <!-- Resource Utilization -->
            <div class="chart-container">
                <div class="chart-title">‚ö° Resource Utilization</div>
                <div class="chart-content">
                    <canvas id="resourceChart"></canvas>
                </div>
            </div>

            <!-- Patient Flow Network -->
            <div class="chart-container large-chart">
                <div class="chart-title">üîÑ Patient Flow Network</div>
                <div class="chart-content" id="flowChart"></div>
            </div>
        </div>
    </div>

    <script>
        // Global chart instances array
        let chartInstances = [];

        // Sample data
        const sampleData = {
            demographics: { Male: 1250, Female: 1250 },
            ageGroups: { '18-29': 300, '30-39': 450, '40-49': 500, '50-59': 600, '60-69': 550, '70-79': 400, '80+': 200 },
            admissionTypes: { Emergency: 1200, Urgent: 800, Elective: 600, Newborn: 400 },
            lengthOfStay: { Emergency: 2.1, ICU: 8.5, Surgery: 6.2, Medicine: 4.8, Cardiology: 5.5, Neurology: 7.2 },
            dischargeDestinations: { Home: 1800, 'Skilled Nursing': 600, 'Home Health': 400, Died: 150, Rehab: 250 },
            mortalityRates: { Emergency: 2.1, ICU: 12.5, Surgery: 3.8, Medicine: 4.2, Cardiology: 6.1, Neurology: 8.3 }
        };

        function createDemographicsChart() {
            const ctx = document.getElementById('demographicsChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(sampleData.demographics),
                    datasets: [{
                        data: Object.values(sampleData.demographics),
                        backgroundColor: ['#667eea', '#764ba2'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            chartInstances.push(chart);
        }

        function createAgeChart() {
            const ctx = document.getElementById('ageChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sampleData.ageGroups),
                    datasets: [{
                        label: 'Number of Patients',
                        data: Object.values(sampleData.ageGroups),
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: '#667eea',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });
            chartInstances.push(chart);
        }

        function createAdmissionChart() {
            const ctx = document.getElementById('admissionChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(sampleData.admissionTypes),
                    datasets: [{
                        data: Object.values(sampleData.admissionTypes),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
            chartInstances.push(chart);
        }

        function createLOSChart() {
            const ctx = document.getElementById('losChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sampleData.lengthOfStay),
                    datasets: [{
                        label: 'Days',
                        data: Object.values(sampleData.lengthOfStay),
                        backgroundColor: 'rgba(118, 75, 162, 0.7)',
                        borderColor: '#764ba2',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: { x: { beginAtZero: true } }
                }
            });
            chartInstances.push(chart);
        }

        function createICUChart() {
            const icuData = [
                { unit: 'MICU', occupancy: [85, 90, 88, 92, 87, 89, 91] },
                { unit: 'SICU', occupancy: [78, 82, 80, 85, 79, 83, 81] },
                { unit: 'CCU', occupancy: [92, 95, 90, 93, 88, 94, 96] },
                { unit: 'CVICU', occupancy: [88, 90, 85, 92, 87, 89, 93] }
            ];

            const traces = icuData.map(unit => ({
                y: unit.occupancy,
                type: 'box',
                name: unit.unit,
                boxpoints: 'outliers'
            }));

            Plotly.newPlot('icuChart', traces, {
                title: false,
                yaxis: { title: 'Occupancy %' },
                margin: { t: 20 }
            }, { responsive: true });
        }

        function createDischargeChart() {
            const ctx = document.getElementById('dischargeChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: Object.keys(sampleData.dischargeDestinations),
                    datasets: [{
                        data: Object.values(sampleData.dischargeDestinations),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.7)',
                            'rgba(118, 75, 162, 0.7)',
                            'rgba(240, 147, 251, 0.7)',
                            'rgba(79, 172, 254, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
            chartInstances.push(chart);
        }

        function createVitalChart() {
            const timeData = Array.from({length: 50}, (_, i) => {
                const time = new Date(Date.now() - (i * 60 * 60 * 1000));
                return {
                    time: time,
                    heartRate: 70 + Math.sin(i * 0.1) * 10 + Math.random() * 5,
                    bloodPressure: 120 + Math.sin(i * 0.2) * 15 + Math.random() * 8,
                    temperature: 98.6 + Math.random() * 2
                };
            });

            const traces = [
                {
                    x: timeData.map(d => d.time),
                    y: timeData.map(d => d.heartRate),
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Heart Rate',
                    line: { color: '#667eea' }
                },
                {
                    x: timeData.map(d => d.time),
                    y: timeData.map(d => d.bloodPressure),
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Blood Pressure',
                    line: { color: '#764ba2' },
                    yaxis: 'y2'
                }
            ];

            Plotly.newPlot('vitalChart', traces, {
                title: false,
                xaxis: { title: 'Time' },
                yaxis: { title: 'Heart Rate (bpm)' },
                yaxis2: { title: 'Blood Pressure (mmHg)', overlaying: 'y', side: 'right' },
                margin: { t: 20 }
            }, { responsive: true });
        }

        function createLabHeatmap() {
            const hours = Array.from({length: 24}, (_, i) => i);
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            const heatmapData = days.map(() => 
                hours.map(() => Math.floor(Math.random() * 50) + 10)
            );

            Plotly.newPlot('labHeatmap', [{
                z: heatmapData,
                x: hours,
                y: days,
                type: 'heatmap',
                colorscale: 'Blues'
            }], {
                title: false,
                xaxis: { title: 'Hour of Day' },
                yaxis: { title: 'Day of Week' },
                margin: { t: 20 }
            }, { responsive: true });
        }

        function createSeasonalChart() {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const admissions = months.map(() => Math.floor(Math.random() * 100) + 200);
            const emergencies = months.map(() => Math.floor(Math.random() * 50) + 50);

            Plotly.newPlot('seasonalChart', [
                {
                    x: months,
                    y: admissions,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Total Admissions',
                    line: { color: '#667eea' }
                },
                {
                    x: months,
                    y: emergencies,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Emergencies',
                    line: { color: '#dc3545' }
                }
            ], {
                title: false,
                xaxis: { title: 'Month' },
                yaxis: { title: 'Number of Admissions' },
                margin: { t: 20 }
            }, { responsive: true });
        }

        function createMortalityChart() {
            const ctx = document.getElementById('mortalityChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sampleData.mortalityRates),
                    datasets: [{
                        label: 'Mortality Rate (%)',
                        data: Object.values(sampleData.mortalityRates),
                        backgroundColor: 'rgba(220, 53, 69, 0.7)',
                        borderColor: '#dc3545',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 15 } }
                }
            });
            chartInstances.push(chart);
        }

        function createResourceChart() {
            const ctx = document.getElementById('resourceChart').getContext('2d');
            const departments = ['Emergency', 'ICU', 'Surgery', 'Medicine', 'Cardiology'];
            
            const chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: departments,
                    datasets: [{
                        label: 'Bed Occupancy (%)',
                        data: [85, 92, 78, 83, 88],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.2)'
                    }, {
                        label: 'Staff Utilization (%)',
                        data: [78, 88, 85, 80, 82],
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: { suggestedMin: 0, suggestedMax: 100 }
                    }
                }
            });
            chartInstances.push(chart);
        }

        function createFlowChart() {
            const svg = d3.select('#flowChart')
                .append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .attr('viewBox', '0 0 800 350');

            const departments = ['Emergency', 'Surgery', 'ICU', 'Medicine', 'Cardiology', 'Discharge'];
            const nodes = departments.map((dept, i) => ({
                id: dept,
                x: (i % 3) * 250 + 150,
                y: Math.floor(i / 3) * 150 + 100,
                value: Math.random() * 100 + 50
            }));

            const links = [
                { source: nodes[0], target: nodes[1], value: 30 },
                { source: nodes[0], target: nodes[2], value: 40 },
                { source: nodes[1], target: nodes[3], value: 25 },
                { source: nodes[2], target: nodes[3], value: 35 },
                { source: nodes[3], target: nodes[4], value: 20 },
                { source: nodes[4], target: nodes[5], value: 45 }
            ];

            // Draw links
            svg.selectAll('.link')
                .data(links)
                .enter()
                .append('line')
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y)
                .attr('stroke', '#667eea')
                .attr('stroke-width', d => d.value / 5)
                .attr('opacity', 0.6);

            // Draw nodes
            svg.selectAll('.node')
                .data(nodes)
                .enter()
                .append('circle')
                .attr('cx', d => d.x)
                .attr('cy', d => d.y)
                .attr('r', d => Math.sqrt(d.value) * 2)
                .attr('fill', '#667eea')
                .attr('stroke', '#fff')
                .attr('stroke-width', 2);

            // Add labels
            svg.selectAll('.label')
                .data(nodes)
                .enter()
                .append('text')
                .attr('x', d => d.x)
                .attr('y', d => d.y + 5)
                .attr('text-anchor', 'middle')
                .attr('fill', 'white')
                .attr('font-weight', 'bold')
                .attr('font-size', '12px')
                .text(d => d.id);
        }

        function refreshCharts() {
            // Add random variation to data
            Object.keys(sampleData.demographics).forEach(key => {
                sampleData.demographics[key] += Math.floor(Math.random() * 20) - 10;
            });
            
            // Destroy existing charts
            chartInstances.forEach(chart => chart.destroy());
            chartInstances = [];
            
            // Clear D3 charts
            d3.select('#flowChart').selectAll('*').remove();
            
            // Recreate all charts
            initializeCharts();
            alert('Charts refreshed with new data!');
        }

        function exportData() {
            const data = JSON.stringify(sampleData, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'hospital_data.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function showInfo() {
            alert(`Hospital Dashboard Information:
            
‚úÖ Total Charts: 12
‚úÖ Chart.js Charts: 7 (Demographics, Age, Admissions, LOS, Discharge, Mortality, Resource)
‚úÖ Plotly.js Charts: 4 (ICU, Vital Signs, Lab Heatmap, Seasonal)
‚úÖ D3.js Charts: 1 (Patient Flow Network)

All visualizations are working properly!`);
        }

        function initializeCharts() {
            try {
                createDemographicsChart();
                createAgeChart();
                createAdmissionChart();
                createLOSChart();
                createICUChart();
                createDischargeChart();
                createVitalChart();
                createLabHeatmap();
                createSeasonalChart();
                createMortalityChart();
                createResourceChart();
                createFlowChart();
                console.log('All charts initialized successfully!');
            } catch (error) {
                console.error('Error initializing charts:', error);
                alert('Some charts failed to load. Check console for details.');
            }
        }

        // Initialize all charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing charts...');
            setTimeout(initializeCharts, 1000); // Give libraries time to load
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            setTimeout(() => {
                chartInstances.forEach(chart => {
                    if (chart && chart.resize) {
                        chart.resize();
                    }
                });
                
                // Resize Plotly charts
                try {
                    Plotly.Plots.resize('icuChart');
                    Plotly.Plots.resize('vitalChart');
                    Plotly.Plots.resize('labHeatmap');
                    Plotly.Plots.resize('seasonalChart');
                } catch (e) {
                    console.log('Plotly resize failed:', e);
                }
            }, 100);
        });
    </script>
</body>
</html>